# Notes related to an OpenAFS 1.8 branch

The current plan is to make a branch for 1.8 off of master in early July 2014.
This will allow all of the improvements and cleanup that have accumulated
on master to be in a stable release series, while letting potentially
destabilizing changes such as rxgk and pthreaded bos land on master to
settle.

A 1.8 release would also bring the possibility of using shared libraries, 
which are now available with the use of libtool.  Currently (on master),
all executable binaries are still linked mostly statically, and most of
the shared libraries that are produced during the build are not installed
to the destination tree.  Exceptions are libafshcrypto.so, libkopenafs.so,
and librokenafs.so.  We could consider installing more shared libraries,
and using dynamic linking for executables, either before or after the
branch point.  Doing so would involve deciding on what sorts of ABI
stability guarantees should be provided.

The remainder of this page has three separate lists, for things to be
done before branching, things to be removed from the 1.8 branch after
it is created, and things to be removed from master after the 1.8 branch
is created.

Things to be done pre-branching:
 
* Make roken and hcrypto use libtool to build
* Make sure libtool is used properly elsewhere, in particular to install
  shared versions of libafsrpc and libafsauthent, which we ship in
  1.6 but do not currently install on master
* Relatedly, verify that the libraries we do ship do not depend on things
  that we don't ship.
* (Optional) Look at the feasibility of installing shared liboafs_foo,
  and using dynamic linkage for the client utilities.
* (rxosd is not going to make it unless someone steps up to do the work;
  we can't block the branch indefinitely on it.)
* Do install and run testing on various platforms; check for memory leaks
  in servers, etc..
* Relatedly, check that the kernel module is properly built and loadable
  on a variety of linuxen.
* Draft Debian packaging (which will help with a lot of the libtool
  validation).
* Whitespace cleanup.
* Any other tree-wide cleanup that people want to get in.
* Adjust the default behavior of configure (pthreaded ubik?  more?)
* Beg and plead for documentation updates.
* Tie the installation of the pam module to --enable/disable-kauth

Things to be removed from 1.8 post-branch:
 
* `src/rxgk`; it is not going to be usable in 1.8
* `src/mcas`; it is not going to be usable in 1.8

Things to be removed from master post-branch:
 
* Several `tfoo` can probably be moved to just `foo`; things like
  `tptserver`, `tvlserver`, `tvolser`, `tsalvaged`.  I'm not sure whether
  `tbudb` and/or `tbutc` are ready.
* push to empty out libutil as much as possible.
* rip out LWP support
* it is tempting to remove kauth, but probably not possible due to agreements with IBM.
