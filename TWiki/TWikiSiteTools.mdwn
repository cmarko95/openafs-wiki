<div>
  <ul>
    <li><a href="#TWiki Site Tools"> TWiki Site Tools</a><ul>
        <li><a href="#WebNotify - recent changes alert"> WebNotify - recent changes alert</a></li>
        <li><a href="#WebSearch - search TWiki site"> WebSearch - search TWiki site</a></li>
        <li><a href="#WebChanges - what's new"> WebChanges - what's new</a></li>
        <li><a href="#WebIndex - list of topics"> WebIndex - list of topics</a></li>
        <li><a href="#WebStatistics - site statistics"> WebStatistics - site statistics</a><ul>
            <li><a href="#Configuring for automatic operat"> Configuring for automatic operation</a></li>
            <li><a href="#Generating statistics manually b"> Generating statistics manually by URL</a></li>
          </ul>
        </li>
        <li><a href="#Log Files"> Log Files</a></li>
        <li><a href="#E-mail"> E-mail</a><ul>
            <li><a href="#Configuring outgoing mail"> Configuring outgoing mail</a></li>
            <li><a href="#Setting the automatic e-mail sch"> Setting the automatic e-mail schedule</a></li>
          </ul>
        </li>
        <li><a href="#Site Permissions"> Site Permissions</a></li>
      </ul>
    </li>
  </ul>
</div>

# <a name="TWiki Site Tools"></a> TWiki Site Tools

_Utilities for searching, navigation, and monitoring site activity_

TWiki Site Tools include utilities for navigating, searching and keeping up with site activity. Preferences can be configured by web or site-wide. You are currently in the **TWiki** web. In particular, TWiki provides two highly configurable, automated site monitoring tools, **WebNotify**, to e-mail alerts when topics are edited, and **WebStatistics**, to generate detailed activity reports.

<a name="WebNotify"></a>

## <a name="WebNotify - recent changes alert"></a><a name="_WebNotify - recent changes aler"></a> WebNotify - recent changes alert

Each TWiki web has an automatic e-mail alert service that sends a list of recent changes on a preset schedule, like once a day. Users can subscribe and unsubscribe using [[WebNotify]] in each web. The Perl script `mailnotify` is called by a background process at regular intervals. The script sends an automated e-mail to subscribed users if topics were changed in a web since the script was last run.

- You can create a [[WebNotify]] link using [[TWikiVariables]] with <code>**%NOTIFYTOPIC%**</code>

You can also use `%MAINWEB%` instead of `Main`, but this is not necessary even if you have renamed the main web by configuring `{MainWebName}` in [configure](http://www.dementia.org/twiki/configure).

<a name="WebSearch"></a>

## <a name="WebSearch - search TWiki site"></a><a name="_WebSearch - search TWiki site"></a> WebSearch - search TWiki site

[[WebSearch]] is an extremely fast and flexible search facility, part of the core TWiki feature set. [[WebSearchAdvanced]] offers more options, including:

- topic title or full-text search
- regular expressions
- search within web or site-wide
- index-style A-Z alphabetical listing sorted topic title
- many more

See also: [[SearchHelp]] for help; [[TWikiVariables]] and [[FormattedSearch]] for including hard-coded searches in text.

<a name="WebChanges"></a>

## <a name="WebChanges - what&#39;s new"></a><a name="_WebChanges - what&#39;s new"></a> WebChanges - what's new

To check for the most recently edited topics while on-site, use the [[WebChanges]] link, usually located in the toolbar. It lists the most recently modified topics, newest first, along with the first couple of lines of the page content.

This is simply a preset `SEARCH`. The number of topics listed by the `limit` parameter.:

> %SEARCH{ ".*" web="%INCLUDINGWEB%" regex="on" nosearch="on" order="modified"%BR% reverse="on" limit="50" }%

<a name="WebIndex"></a>

## <a name="WebIndex - list of topics"></a><a name="_WebIndex - list of topics"></a> WebIndex - list of topics

[[WebIndex]] lists all web topics in alphabetical order, with the first couple of lines of text. This is simply a preset `SEARCH`:

> %SEARCH{ "\.*" scope="topic" regex="on" nosearch="on" }%

<a name="WebStatistics"></a>

## <a name="WebStatistics - site statistics"></a><a name="_WebStatistics - site statistics"></a> WebStatistics - site statistics

You can generate a listing manually, or on an automated schedule, of visits to individual pages, on a per web basis. Compiled as a running total on a monthly basis. Includes totals for Topic Views, Topic Saves, Attachment Uploads, Most Popular Topics with number of views, and Top Contributors showing total of saves and attachment uploads. Previous months are saved.

- You can create a [[WebStatistics]] link using [[TWikiVariables]] with <code>**%STATISTICSTOPIC%**</code>

### <a name="Configuring for automatic operat"></a> Configuring for automatic operation

- You can automatically generate usage statistics for all webs. To enable this:
  - Make sure variable **\{Log\}\{view\}**, **\{Log\}\{save\}** and \*\{Log\}\{upload\} in are set in [configure](http://www.dementia.org/twiki/configure). This will generate log file entries (see below).
  - The [[WebStatistics]] topic must be present in all webs where you want to have statistics. You can use the topic in the Main web as a template.
  - Call the `twiki/bin/statistics` script from a cron job, once a day is recommended. This will update the [[WebStatistics]] topics in all webs.
  - **_Attention:_** The script must run as the same user as the CGI scripts are running, which is user `nobody` on many systems. Example crontab entry: %BR% `0 0 * * * (cd /path/to/twiki/bin; ./statistics >/dev/null 2>&1)`
  - There is a workaround in case you can't run the script as user `nobody` : Run the utility `twiki/bin/geturl` in your cron job and specify the URL of the `twiki/bin/statistics` script as a parameter. Example: %BR% `0 0 * * * (cd /path/to/twiki/bin; ./geturl mydomain.com /urlpath/to/twiki/bin/statistics >/dev/null 2>&1)`

When running from the command line or a cron job, you can pass parameters to the script like this:

    ./statistics -logdate 200605 -webs TWiki,Sandbox

### <a name="Generating statistics manually b"></a> Generating statistics manually by URL

- The `twiki/bin/statistics` script can also be executed as a CGI script, just enter the URL in your browser. Examples:
  - Update current month for all webs you have access to: %BR% `http://www.dementia.org/twiki/statistics`
  - Update current month for Main web only: %BR% `http://www.dementia.org/twiki/statistics/Main`
  - Update Jun 2010 for Main web: %BR% `http://www.dementia.org/twiki/statistics/Main?logdate=201006`
  - Update Jun 2010 for the ProjectX, ProjectY and ProjectZ webs: %BR% `http://www.dementia.org/twiki/statistics?logdate=201006;webs=ProjectX,ProjectY,ProjectZ`

<a name="LogFiles"></a>

## <a name="Log Files"></a> Log Files

TWiki generates monthly log files which are used by the statistics script

- The log file is defined by the **\{LogFileName\}** setting in [configure](http://www.dementia.org/twiki/configure)
- The file name is `log<year><month>.txt`
- Example path name: `twiki/logs/log201006.txt`
- Each access gets logged as: %BR% `| <time> | <wikiusername> | <action> | <web>.<topic> | <extra info> | <IP address> |`
- Example log entry: %BR% <code>| 29 Jun 2010 - 12:00 | [[TWikiGuest]] | view | [[WebRss]] |  | 66.124.232.02 |</code>
- Actions are logged if enabled in [configure](http://www.dementia.org/twiki/configure) by the **\{Log\}\{_action_\}** flags
- Logged actions: <table border="1" cellpadding="0" cellspacing="0">
  <tr>
    <th bgcolor="#99CCCC"><strong> Script </strong></th>
    <th bgcolor="#99CCCC"><strong> Action name </strong></th>
    <th bgcolor="#99CCCC"><strong> Extra info </strong></th>
  </tr>
  <tr>
    <td> attach </td>
    <td><code>attach</code></td>
    <td> when viewing attach screen of previous uploaded attachment: <code>filename</code></td>
  </tr>
  <tr>
    <td> changes </td>
    <td><code>changes</code></td>
    <td>   </td>
  </tr>
  <tr>
    <td> edit </td>
    <td><code>edit</code></td>
    <td> when editing non-existing topic: <code>(not exist)</code></td>
  </tr>
  <tr>
    <td> rdiff </td>
    <td><code>rdiff</code></td>
    <td> higher and lower revision numbers: <code>4 3</code></td>
  </tr>
  <tr>
    <td> register </td>
    <td><code>regstart</code></td>
    <td> WikiUserName, e-Mail address, [[Main/LoginName]]: <code>user attempts to register</code></td>
  </tr>
  <tr>
    <td> register </td>
    <td><code>register</code></td>
    <td> E-mail address: <code>user successfully registers</code></td>
  </tr>
  <tr>
    <td> register </td>
    <td><code>bulkregister</code></td>
    <td> WikiUserName of new, e-mail address, admin ID </td>
  </tr>
  <tr>
    <td> rename </td>
    <td><code>rename</code></td>
    <td> when moving topic: <code>moved to Newweb.NewTopic</code></td>
  </tr>
  <tr>
    <td> rename </td>
    <td><code>move</code></td>
    <td> when moving attachment: <code>Attachment filename moved to Newweb.NewTopic</code></td>
  </tr>
  <tr>
    <td> passwd </td>
    <td><code>resetpasswd</code></td>
    <td>[[Main/LoginName]], [[Main/WikiName]], E-mail address, success code from addUserPassword </td>
  </tr>
  <tr>
    <td> passwd </td>
    <td><code>changepasswd</code></td>
    <td>[[Main/LoginName]], [[Main/WikiName]]</td>
  </tr>
  <tr>
    <td> save </td>
    <td><code>save</code></td>
    <td> when replacing existing revision: <code>repRev 3</code> %BR% when user checks the minor changes box: <code>dontNotify</code></td>
  </tr>
  <tr>
    <td> search </td>
    <td><code>search</code></td>
    <td> search string </td>
  </tr>
  <tr>
    <td> upload </td>
    <td><code>upload</code></td>
    <td> filename </td>
  </tr>
  <tr>
    <td> view </td>
    <td><code>view</code></td>
    <td> when viewing non-existing topic: <code>(not exist)</code> %BR% when viewing previous topic revision: <code>r3</code></td>
  </tr>
</table>

<a name="ConfigureEmail"></a>

## <a name="E-mail"></a> E-mail

### <a name="Configuring outgoing mail"></a> Configuring outgoing mail

Outgoing mail is required for [[TWikiRegistration]] and for [[recent changes alert|Main/WebHome#WebNotify]].

TWiki will use the <code>**Net::SMTP**</code> module if it is installed on your system. Set this with the <code>**SMTPMAILHOST**</code> variable in [[TWikiPreferences]].

The notify e-mail uses the default `changes.tmpl` template, or a skin if activated in the [[TWikiPreferences]].

mailnotify also relies on two hidden files in each `twiki/data/Web` directory: `.changes` and `.mailnotify.` Make sure both are writable by your web server process. `.changes` contains a list of changes; go ahead and make this empty. `.mailnotify` contains a timestamp of the last time notification was done.

You can use an external mail program, such as <code>**sendmail**</code>, if the `Net::SMTP` module is not installed. Set the program path in <code>**\{MailProgram\}**</code> in [configure](http://www.dementia.org/twiki/configure).

- %H% Net::SMTP can be easily disabled (if there is an installation error) by setting <code>**SMTPMAILHOST**</code> in [[TWikiPreferences]] to an empty value.

- %T% You can set a separate <code>**SMTPSENDERHOST**</code> variable to define the mail sender host (some SMTP installations require this).

### <a name="Setting the automatic e-mail sch"></a> Setting the automatic e-mail schedule

**For Unix platforms:** Edit the `cron` table so that `mailnotify` is called in an interval of your choice. Please consult `man crontab` of how to modify the table that schedules program execution at certain intervals. Example:

    % crontab -e
    0 2 * * * (cd /path/to/twiki/bin; ./mailnotify -q)

The above line will run mailnotify nightly at 02:00. The `-q` switch suppresses all normal output.

**For ISP installations:** Many ISPs don't allow hosted accounts direct cron access, as it's often used for things that can heavily load the server. Workaround scripts are available.

**On Windows:** You can use a scheduled task if you have administrative privileges. TWiki:Codev/CronTabWin is a free scheduler for Windows.

## <a name="Site Permissions"></a> Site Permissions

- [[TWikiAccessControl]] describes how to restrict read and write access to topics and webs, by users and groups
- [[SitePermissions]] lists the permissions settings of the webs on this TWiki site

**_Related Topics:_** [[AdminDocumentationCategory]], [[AdminToolsCategory]]
